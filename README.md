# Заметки о Трекере Расходов (SpendingTracker)

SpendingTracker — это веб-сервис на базе FastAPI, который предоставляет функциональные REST API для управления личными расходами, категориями, отчетами и транзакциями.

## Особенности
- **Аутентификация (Auth)**: Регистрация пользователей, вход (JWT) и обновление профиля.
- **Категории (Categories)**: Создание, чтение, обновление, удаление категорий расходов.
- **Транзакции (Transactions)**: Запись и отслеживание транзакций.
- **Отчеты (Reports)**: Запрос отчетов по расходам, которые эффективно управляются через Apache Kafka и обрабатываются фоновыми задачами.

## Внутренние Сервисы

Логика структуры приложения разделена на следующие внутренние сервисы:
- **Сервис Категорий (Category Service)**: Управляет созданием, получением, обновлением и удалением категорий расходов.
- **Сервис Отчетов (Report Service)**: Обрабатывает асинхронное создание отчетов по расходам с использованием фоновых задач Kafka.
- **Сервис Транзакций (Transaction Service)**: Обрабатывает и записывает доходы и расходы пользователя.
- **Сервис Пользователей (User Service)**: Управляет учетными записями пользователей, аутентификацией и обновлениями профиля.

## Установка и Настройка

Docker — единственное строгое требование для этого проекта! Git опционален, так как вы можете скачать исходный код в виде ZIP-архива.

### Предварительные Требования
Перед началом работы убедитесь, что вы установили и запустили:
- **[Docker Desktop](https://docs.docker.com/get-docker/)** (Пожалуйста, убедитесь, что Docker Engine запущен!)
- **[Git](https://git-scm.com/downloads)** (Опционально, для клонирования репозитория)

### 1. Получение Исходного Кода
Вы можете клонировать репозиторий через Git или скачать ZIP-архив:

**Вариант А: Использование Git**
```bash
git clone https://github.com/yourusername/SpendingTracker.git
cd SpendingTracker
```

**Вариант Б: Скачивание ZIP-архива**
1. Нажмите зеленую кнопку **Code** на странице репозитория GitHub и выберите **Download ZIP**.
2. Распакуйте скачанный архив.
3. Откройте терминал и перейдите в извлеченную папку:
```bash
cd SpendingTracker
```
(Все последующие команды выполняются из этой папки).

### 2. Подготовка Образа Kafka
Оригинальный образ `bitnami/kafka` больше не хостится активно под этим именем. Чтобы исправить это, загрузите старый образ и локально добавьте ему тег:
```bash
docker pull bitnamilegacy/kafka
docker tag bitnamilegacy/kafka bitnami/kafka
```

### 3. Сборка и Запуск
Соберите образ приложения из Dockerfile и запустите бэкенд сервисы:
```bash
docker build -t api .
docker-compose up -d
```

## Запуск Приложения
Сервер станет доступен вскоре после запуска по адресу `http://localhost:8000`. 
Чтобы изучить API и взаимодействовать с ним, перейдите по URL-адресу Swagger UI:
- `http://localhost:8000/docs`

## Тестирование и Линтинг

**Запуск Линтера (ruff):**
```bash
make lint
```

**Запуск Тестов (pytest):**
```bash
make test
```

## Конечные Точки API (API Endpoints)

### Аутентификация (Auth)
- `POST /signup`: Регистрация нового пользователя и получение JWT.
- `POST /signin`: Вход.
- `GET /verify`: Получить информацию о текущем пользователе.
- `PATCH /users/{user_id}`: Обновить данные пользователя.

### Категории (Categories)
- `GET /`: Получить все категории для аутентифицированного пользователя.
- `POST /`: Создать новую категорию.
- `GET /{category_id}`: Получить детали категории.
- `PUT /{category_id}`: Обновить категорию.
- `DELETE /{category_id}`: Удалить категорию.

### Транзакции (Transactions)
- `GET /`: Список всех транзакций пользователя.
- `POST /`: Создать новую транзакцию.
- `GET /{transaction_id}`: Показать детали транзакции.
- `PUT /{transaction_id}`: Изменить транзакцию.
- `DELETE /{transaction_id}`: Удалить транзакцию.

### Отчеты (Reports)
- `POST /create_report`: Создать новый отчет (обрабатывается асинхронно через Kafka).
- `GET /get_report`: Получить отчет по ID.
- `DELETE /delete_report`: Удалить отчет.
